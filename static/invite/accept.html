<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accept Organisation Invite</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    .card { max-width: 560px; padding: 1.25rem 1.5rem; border: 1px solid #ddd; border-radius: 8px; }
    input { width: 100%; padding: 0.5rem; margin-top: 0.25rem; }
    button { margin-top: 1rem; padding: 0.6rem 1rem; }
    .ok { color: #0a7b25; }
    .err { color: #b00020; }
    .token { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #f7f7f7; padding: 0.5rem; border-radius: 6px; word-break: break-all; }
  </style>
  <script>
    function init() {
      const params = new URLSearchParams(location.search);
      const t = params.get('token') || '';
      if (t) document.getElementById('token').value = t;
    }
    async function acceptInvite(ev) {
      ev.preventDefault();
      const token = document.getElementById('token').value.trim();
      const out = document.getElementById('output');
      out.textContent = '';
      try {
        const res = await fetch('/auth/invite/accept', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ token })
        });
        const txt = await res.text();
        let data = {};
        try { data = JSON.parse(txt); } catch {}
        if (!res.ok) throw new Error(data.error || txt || ('HTTP ' + res.status));
        out.className = 'ok';
        out.textContent = 'Invite accepted. Your active org is switched. You can now proceed to the app.';
      } catch (err) {
        out.className = 'err';
        out.textContent = 'Error: ' + err.message + '. Ensure you are logged in with the invited email.';
      }
    }
  </script>
</head>
<body onload="init()">
  <div class="card">
    <h2>Accept Invite</h2>
    <p>Paste your invite token below and press Accept. You must be logged in with the invited email address.</p>
    <form onsubmit="acceptInvite(event)">
      <input id="token" placeholder="paste token here" />
      <button type="submit">Accept</button>
    </form>
    <p id="output"></p>
  </div>
</body>
</html>


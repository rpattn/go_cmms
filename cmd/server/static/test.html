<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>API Test</title>
</head>

<body>
  <h1>Auth API Test</h1>

  <h2>Signup</h2>
  <form id="signup-form">
    <input type="email" id="signup-email" placeholder="Email" required /><br />
    <input type="text" id="signup-username" placeholder="Username (optional)" /><br />
    <input type="text" id="signup-name" placeholder="Name" /><br />
    <input type="password" id="signup-password" placeholder="Password" required /><br />
    <input type="text" id="signup-org" placeholder="Org slug" /><br />
    <button type="submit">Signup</button>
  </form>

  <h2>Sign in with Microsoft</h2>
  <form id="signin-microsoft-form">
    <button type="submit">Sign in with Microsoft</button>
  </form>

  <h2>Login</h2>
  <form id="login-form">
    <input type="text" id="login-username" placeholder="Username or email" required /><br />
    <input type="password" id="login-password" placeholder="Password" required /><br />
    <input type="text" id="login-totp" placeholder="TOTP code (optional)" /><br />
    <button type="submit">Login</button>
  </form>

  <script>
    const baseUrl = "http://localhost:8080"; // match your BASE_URL

    document.getElementById("signup-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const body = {
        email: document.getElementById("signup-email").value,
        username: document.getElementById("signup-username").value,
        name: document.getElementById("signup-name").value,
        password: document.getElementById("signup-password").value,
        org_slug: document.getElementById("signup-org").value,
      };
      console.log("Signup request:", body);
      try {
        const res = await fetch(baseUrl + "/auth/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const data = await res.json();
        console.log("Signup response:", res.status, data);
      } catch (err) {
        console.error("Signup error:", err);
      }
    });

    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const body = {
        username: document.getElementById("login-username").value,
        password: document.getElementById("login-password").value,
        totp_code: document.getElementById("login-totp").value,
      };
      console.log("Login request:", body);
      try {
        const res = await fetch(baseUrl + "/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        const data = await res.json();
        console.log("Login response:", res.status, data);
      } catch (err) {
        console.error("Login error:", err);
      }
    });

    document.getElementById("signin-microsoft-form").addEventListener("submit", (e) => {
      e.preventDefault();
      console.log("Redirecting to Microsoft login...");
      window.location.href = baseUrl + "/auth/microsoft";
    });
  </script>
</body>

</html>